"use strict";function formCheck(){function e(e,n,a){var t=e.value,i=e.name,r=e.parentNode.getElementsByClassName("error"),s=document.createElement("span");if(s.className="error",s.innerHTML=a,"name"===i&&e.textLength>2&&e.textLength<21)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),r[0]&&r[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(s,e));else if("secondname"===i&&e.textLength>3&&e.textLength<61)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),r[0]&&r[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),console.log(e.className),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(s,e));else if("email"===i&&e.textLength>3&&e.textLength<25)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),r[0]&&r[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),console.log(e.className),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(s,e));else if("pass"===i&&e.textLength>3&&e.textLength<18)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),r[0]&&r[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),console.log(e.className),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(s,e));else if(e.classList.remove("granted"),e.classList.add("denied"),3===e.previousSibling.nodeType||"error"!==e.previousSibling.className){var s=document.createElement("span");s.className="error",s.innerHTML=a,r[0]||e.parentNode.appendChild(s,e)}}function n(){e(this,/^[A-ZА-ЯЁ]{0,1}[a-zA-Zа-яёА-ЯЁ\s\-]+$/u," Имя задано неправильно ")}function a(){e(this,/^[A-ZА-ЯЁ]{0,1}[a-zA-Zа-яёА-ЯЁ\s\-]+$/u," Фамилия задано неправильно ")}function t(){e(this,/^([a-z0-9_-]{1,15}\.){0,3}[a-z0-9_-]{1,15}@[a-z0-9_-]{1,15}\.[a-z]{2,6}$/u," Email задан неправильно ")}function i(){e(this,/^[a-z0-9-_]{6,}$/," Email задан неправильно ")}var r=document.forms.form,s=r.elements.name,o=r.elements.secondname,l=r.elements.email,d=r.elements.pass;s&&(s.onchange=n),o&&(o.onchange=a),l&&(l.onchange=t),d&&(d.onchange=i)}function call(){var e=$("#form").serialize();$.ajax({type:"POST",url:"http://codeit.pro/frontTestTask/user/registration",data:e,success:function(e){function n(e,n){var a=document.createElement("span"),t=e.parentNode.getElementsByClassName("error");a.className="error",a.innerHTML=n,t[0]||e.parentNode.appendChild(a,e)}var a=document.forms.form,t=a.elements.name,i=a.elements.secondname,r=a.elements.email,s=a.elements.pass;"OK"===e.status&&alert("регистрация завершена"),"Form Error"===e.status?"email"===e.field?n(r,"Недопустимый email"):"secondname"===e.field?"Field 'secondname' should contain from 3 to 60 letters"===e.message?n(i,"Фамилия должна быть больше 3 символов"):n(i,"Недопустимая Фамилия"):"name"===e.field?"Field 'name' should contain from 3 to 60 letters"===e.message?n(t,"Имя должно быть больше 3 символов"):n(t,"Недопустимое Имя"):n(s,"Недопустимый пароль"):"Creating user error. Email already exists."===e.message?n(r,"Email уже существует"):alert("Ошибка! Неправильный маршрут")},error:function(e){"Error"===e.status&&"Creating user error. Email already exists."!==e.message&&alert("Ошибка! Неправильный маршрут")}})}$(document).ready(function(){$.getJSON("http://codeit.pro/frontTestTask/company/getList",function(e){function n(e){for(var n=[],a=0;a<e.length;a++)for(var t in e[a])if("partners"===t)for(var i=0;i<e[a][t].length;i++)n.push({name:e[a][t][i].name,value:e[a][t][i].value});return n}function a(e){for(var n=[],a=0;a<e.length;a++)for(var t in e[a])"location"===t&&n.push({name:e[a][t].name,value:e[a][t].code});return n}function t(e){for(var n=[[],[],[],[],[],[]],a=0;a<e.length;a++)"Poland"===e[a].location.name&&n[0].push(e[a].name),"Ukraine"===e[a].location.name&&n[1].push(e[a].name),"United States"===e[a].location.name&&n[2].push(e[a].name),"Norway"===e[a].location.name&&n[3].push(e[a].name),"Sweden"===e[a].location.name&&n[4].push(e[a].name),"Germany"===e[a].location.name&&n[5].push(e[a].name);return n}function i(){for(var e=a(r.list),n=[],t=[],i={poland:0,ukraine:0,united_states:0,norway:0,sweden:0,germany:0},s=0;s<e.length;s++)"Poland"===e[s].name&&(i.poland+=1),"Ukraine"===e[s].name&&(i.ukraine+=1),"Germany"===e[s].name&&(i.germany+=1),"United States"===e[s].name&&(i.united_states+=1),"Norway"===e[s].name&&(i.norway+=1),"Sweden"===e[s].name&&(i.sweden+=1),-1===t.indexOf(e[s].value)&&t.push(e[s].value);for(var s=0;s<t.length;s++)"PL"===t[s]&&n.push({name:t[s],y:i.poland}),"UA"===t[s]&&n.push({name:t[s],y:i.ukraine}),"US"===t[s]&&n.push({name:t[s],y:i.united_states}),"NO"===t[s]&&n.push({name:t[s],y:i.norway}),"SE"===t[s]&&n.push({name:t[s],y:i.sweden}),"DE"===t[s]&&n.push({name:t[s],y:i.germany});return n}var r=e,s="<div class='totalCompanies'><span>"+r.list.length+"</span></div>",o=(new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0}),n(r.list));$("#totalCompanies").append(s);for(var l=0;l<r.list.length;l++)for(var d in r.list[l])"name"===d&&$("#listCompanies ul").append("<li>"+r.list[l][d]+"</li>");$("#listCompanies ul li").on("click",function(){$(this).hasClass("active")?($("#listCompanies ul li").removeClass("active"),$(this).removeClass("active"),$(".blockWrap").slideUp()):($("#listCompanies ul li").removeClass("active"),$(this).addClass("active"),$(".blockWrap").slideDown())}),o.sort(function(e,n){return e.value<n.value?1:e.value>n.value?-1:void 0});for(var l=0;l<o.length;l++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[l].value+"%</h2></div><div class='partnerBox'><h2>"+o[l].name+"</h2></div></div></li>");$("#sort .fa-caret-up").on("click",function(){o.sort(function(e,n){return e.name>n.name?1:e.name<n.name?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),$("#sort .fa-caret-down").on("click",function(){o.sort(function(e,n){return e.name<n.name?1:e.name>n.name?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),$("#percent .fa-caret-up").on("click",function(){o.sort(function(e,n){return e.value>n.value?1:e.value<n.value?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),$("#percent .fa-caret-down").on("click",function(){o.sort(function(e,n){return e.value<n.value?1:e.value>n.value?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),Highcharts.chart("container",{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",context:!0},credits:{enabled:!1},exporting:{buttons:{contextButton:{enabled:!1}}},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{name:"Brands",colorByPoint:!0,data:i()}],responsive:{rules:[{condition:{minWidth:319}}]}}),$("#container").on("click",function(e){e.preventDefault();var n=e.target.attributes[6].value,a=t(r.list);$("#listLocations").empty();for(var i=0;i<a.length;i++)if(-1!==n.indexOf(i))for(var s=0;s<a[i].length;s++)$("#listLocations").append("<li>"+a[i][s]+"</li>");$("#overlay").fadeIn(400,function(){$("#modalForm").css("display","block").animate({opacity:1,top:"50%"},200)})}),$("#modalClose, #overlay").on("click",function(){$("#modalForm").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)})})}).done(function(){$(".loader").delay(100).fadeOut("slow")}),$.getJSON("http://codeit.pro/frontTestTask/news/getList",function(e){function n(e){for(var n=document.getElementsByClassName("swiper-slide"),t=0;t<n.length;t++)n[t].children[0].setAttribute("src",e[t].img),n[t].children[1].children[0].setAttribute("href","http://"+e[t].link),e[t].description.length>200?(i=e[t].description.substring(0,199)+" ...",n[t].children[1].children[1].innerHTML=i):n[t].children[1].children[1].innerHTML=e[t].description,n[t].children[2].children[0].children[0].innerHTML=e[t].author,n[t].children[2].children[1].children[0].setAttribute("datetime",a(e[t].date)),n[t].children[2].children[1].children[0].innerHTML=a(e[t].date)}function a(e){var n=new Date(1e3*e),a=["01","02","03","04","05","06","07","08","09","10","11","12"];return n.getFullYear()+"-"+a[n.getMonth()]+"-"+(n.getDate()<10?"0"+n.getDate():n.getDate())}var t=e,i="";n(t.list)}).done(function(){$(".loader").delay(100).fadeOut("slow")})}),window.load=formCheck,formCheck();