"use strict";function formCheck(){function e(e,n,a){var t=e.value,r=e.name,s=e.parentNode.getElementsByClassName("error"),i=document.createElement("span");if(i.className="error",i.innerHTML=a,"name"===r&&t.length>2&&t.length<21)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),s[0]&&s[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(i,e));else if("secondname"===r&&t.length>3&&t.length<61)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),s[0]&&s[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),console.log(e.className),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(i,e));else if("email"===r&&t.length>3&&t.length<25)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),s[0]&&s[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),console.log(e.className),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(i,e));else if("pass"===r&&t.length>3&&t.length<18)n.test(t)?(e.classList.remove("denied"),e.classList.add("granted"),s[0]&&s[0].remove()):(e.classList.remove("granted"),e.classList.add("denied"),console.log(e.className),3!==e.previousSibling.nodeType&&"error"===e.previousSibling.className||e.parentNode.appendChild(i,e));else if(e.classList.remove("granted"),e.classList.add("denied"),3===e.previousSibling.nodeType||"error"!==e.previousSibling.className){var i=document.createElement("span");i.className="error",i.innerHTML=a,s[0]||e.parentNode.appendChild(i,e)}}function n(){e(this,/^[A-ZА-ЯЁ]{0,1}[a-zA-Zа-яёА-ЯЁ\s\-]+$/," Incorrect name ")}function a(){e(this,/^[A-ZА-ЯЁ]{0,1}[a-zA-Zа-яёА-ЯЁ\s\-]+$/u," Incorrect last name ")}function t(){e(this,/^([a-z0-9_-]{1,15}\.){0,3}[a-z0-9_-]{1,15}@[a-z0-9_-]{1,15}\.[a-z]{2,6}$/u," Incorrect email ")}function r(){e(this,/^[a-z0-9-_]{6,}$/," Incorrect password ")}var s=document.forms.form,i=s.elements.name,o=s.elements.secondname,l=s.elements.email,c=s.elements.pass;i&&(i.onchange=n),o&&(o.onchange=a),l&&(l.onchange=t),c&&(c.onchange=r)}function call(){var e=$("#form").serialize();$.ajax({type:"POST",url:"http://codeit.pro/frontTestTask/user/registration",data:e,success:function(e){function n(e,n){var a=document.createElement("span"),t=e.parentNode.getElementsByClassName("error");a.className="error",a.innerHTML=n,t[0]||e.parentNode.appendChild(a,e)}var a=document.forms.form,t=a.elements.name,r=a.elements.secondname,s=a.elements.email,i=a.elements.pass;"OK"===e.status&&alert("Registration is complete"),"Form Error"===e.status?"email"===e.field?n(s,"Incorrect email"):"secondname"===e.field?"Field 'secondname' should contain from 3 to 60 letters"===e.message?n(r,"Last name must be more than 3 characters"):n(r,"Incorrect last name"):"name"===e.field?"Field 'name' should contain from 3 to 60 letters"===e.message?n(t,"Name must be more than 3 characters"):n(t,"Incorrect name"):n(i,"Incorrect password"):"Creating user error. Email already exists."===e.message?n(s,"Email already exists"):alert("Error! Incorrect Route")},error:function(e){"Error"===e.status&&"Creating user error. Email already exists."!==e.message&&alert("Error! Incorrect Route")}})}$(document).ready(function(){$.getJSON("http://codeit.pro/frontTestTask/company/getList",function(e){function n(e){for(var n=[],a=0;a<e.length;a++)for(var t in e[a])if("partners"===t)for(var r=0;r<e[a][t].length;r++)n.push({name:e[a][t][r].name,value:e[a][t][r].value});return n}function a(e){for(var n=[],a=0;a<e.length;a++)for(var t in e[a])"location"===t&&n.push({name:e[a][t].name,value:e[a][t].code});return n}function t(e){for(var n=[[],[],[],[],[],[]],a=0;a<e.length;a++)"Poland"===e[a].location.name&&n[0].push(e[a].name),"Ukraine"===e[a].location.name&&n[1].push(e[a].name),"United States"===e[a].location.name&&n[2].push(e[a].name),"Norway"===e[a].location.name&&n[3].push(e[a].name),"Sweden"===e[a].location.name&&n[4].push(e[a].name),"Germany"===e[a].location.name&&n[5].push(e[a].name);return n}function r(){for(var e=a(s.list),n=[],t=[],r={poland:0,ukraine:0,united_states:0,norway:0,sweden:0,germany:0},i=0;i<e.length;i++)"Poland"===e[i].name&&(r.poland+=1),"Ukraine"===e[i].name&&(r.ukraine+=1),"Germany"===e[i].name&&(r.germany+=1),"United States"===e[i].name&&(r.united_states+=1),"Norway"===e[i].name&&(r.norway+=1),"Sweden"===e[i].name&&(r.sweden+=1),-1===t.indexOf(e[i].value)&&t.push(e[i].value);for(var i=0;i<t.length;i++)"PL"===t[i]&&n.push({name:t[i],y:r.poland}),"UA"===t[i]&&n.push({name:t[i],y:r.ukraine}),"US"===t[i]&&n.push({name:t[i],y:r.united_states}),"NO"===t[i]&&n.push({name:t[i],y:r.norway}),"SE"===t[i]&&n.push({name:t[i],y:r.sweden}),"DE"===t[i]&&n.push({name:t[i],y:r.germany});return n}var s=e,i="<div class='totalCompanies'><span>"+s.list.length+"</span></div>",o=(new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0}),n(s.list));$("#totalCompanies").append(i);for(var l=0;l<s.list.length;l++)for(var c in s.list[l])"name"===c&&$("#listCompanies ul").append("<li>"+s.list[l][c]+"</li>");$("#listCompanies ul li").on("click",function(){$(this).hasClass("active")?($("#listCompanies ul li").removeClass("active"),$(this).removeClass("active"),$(".blockWrap").slideUp()):($("#listCompanies ul li").removeClass("active"),$(this).addClass("active"),$(".blockWrap").slideDown())}),o.sort(function(e,n){return e.value<n.value?1:e.value>n.value?-1:void 0});for(var l=0;l<o.length;l++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[l].value+"%</h2></div><div class='partnerBox'><h2>"+o[l].name+"</h2></div></div></li>");$("#sort .fa-caret-up").on("click",function(){o.sort(function(e,n){return e.name>n.name?1:e.name<n.name?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),$("#sort .fa-caret-down").on("click",function(){o.sort(function(e,n){return e.name<n.name?1:e.name>n.name?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),$("#percent .fa-caret-up").on("click",function(){o.sort(function(e,n){return e.value>n.value?1:e.value<n.value?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),$("#percent .fa-caret-down").on("click",function(){o.sort(function(e,n){return e.value<n.value?1:e.value>n.value?-1:void 0}),$("#partnersList").empty();for(var e=0;e<o.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+o[e].value+"%</h2></div><div class='partnerBox'><h2>"+o[e].name+"</h2></div></div></li>")}),Highcharts.chart("container",{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",context:!0},credits:{enabled:!1},exporting:{buttons:{contextButton:{enabled:!1}}},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{name:"Brands",colorByPoint:!0,data:r()}],responsive:{rules:[{condition:{minWidth:319}}]}}),$("#container").on("click",function(e){e.preventDefault();var n=e.target.attributes[6].value,a=t(s.list);$("#listLocations").empty();for(var r=0;r<a.length;r++)if(-1!==n.indexOf(r))for(var i=0;i<a[r].length;i++)$("#listLocations").append("<li>"+a[r][i]+"</li>");$("#overlay").fadeIn(400,function(){$("#modalForm").css("display","block").animate({opacity:1,top:"50%"},200)})}),$("#modalClose, #overlay").on("click",function(){$("#modalForm").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)})})}).done(function(){$(".loader").delay(100).fadeOut("slow")}),$.getJSON("http://codeit.pro/frontTestTask/news/getList",function(e){function n(e){for(var n=document.getElementsByClassName("swiper-slide"),t=0;t<n.length;t++)n[t].children[0].setAttribute("src",e[t].img),n[t].children[1].children[0].setAttribute("href","http://"+e[t].link),e[t].description.length>200?(r=e[t].description.substring(0,199)+" ...",n[t].children[1].children[1].innerHTML=r):n[t].children[1].children[1].innerHTML=e[t].description,n[t].children[2].children[0].children[0].innerHTML=e[t].author,n[t].children[2].children[1].children[0].setAttribute("datetime",a(e[t].date)),n[t].children[2].children[1].children[0].innerHTML=a(e[t].date)}function a(e){var n=new Date(1e3*e),a=["01","02","03","04","05","06","07","08","09","10","11","12"];return n.getFullYear()+"-"+a[n.getMonth()]+"-"+(n.getDate()<10?"0"+n.getDate():n.getDate())}var t=e,r="";n(t.list)}).done(function(){$(".loader").delay(100).fadeOut("slow")})}),window.load=formCheck,formCheck();