"use strict";$(document).ready(function(){$.getJSON("http://codeit.pro/frontTestTask/company/getList",function(e){function n(e){for(var n=[],t=0;t<e.length;t++)for(var a in e[t])if("partners"===a)for(var i=0;i<e[t][a].length;i++)n.push({name:e[t][a][i].name,value:e[t][a][i].value});return n}function t(e){for(var n=[],t=0;t<e.length;t++)for(var a in e[t])"location"===a&&n.push({name:e[t][a].name,value:e[t][a].code});return n}function a(e){for(var n=[[],[],[],[],[],[]],t=0;t<e.length;t++)"Poland"===e[t].location.name&&n[0].push(e[t].name),"Ukraine"===e[t].location.name&&n[1].push(e[t].name),"United States"===e[t].location.name&&n[2].push(e[t].name),"Norway"===e[t].location.name&&n[3].push(e[t].name),"Sweden"===e[t].location.name&&n[4].push(e[t].name),"Germany"===e[t].location.name&&n[5].push(e[t].name);return n}function i(){for(var e=t(r.list),n=[],a=[],i={poland:0,ukraine:0,united_states:0,norway:0,sweden:0,germany:0},o=0;o<e.length;o++)"Poland"===e[o].name&&(i.poland+=1),"Ukraine"===e[o].name&&(i.ukraine+=1),"Germany"===e[o].name&&(i.germany+=1),"United States"===e[o].name&&(i.united_states+=1),"Norway"===e[o].name&&(i.norway+=1),"Sweden"===e[o].name&&(i.sweden+=1),-1===a.indexOf(e[o].value)&&a.push(e[o].value);for(var o=0;o<a.length;o++)"PL"===a[o]&&n.push({name:a[o],y:i.poland}),"UA"===a[o]&&n.push({name:a[o],y:i.ukraine}),"US"===a[o]&&n.push({name:a[o],y:i.united_states}),"NO"===a[o]&&n.push({name:a[o],y:i.norway}),"SE"===a[o]&&n.push({name:a[o],y:i.sweden}),"DE"===a[o]&&n.push({name:a[o],y:i.germany});return n}var r=e,o="<div class='totalCompanies'><span>"+r.list.length+"</span></div>",l=(new Swiper(".swiper-container",{pagination:".swiper-pagination",paginationClickable:!0}),n(r.list));$("#totalCompanies").append(o);for(var s=0;s<r.list.length;s++)for(var c in r.list[s])"name"===c&&$("#listCompanies ul").append("<li>"+r.list[s][c]+"</li>");$("#listCompanies ul li").on("click",function(){$(this).hasClass("active")?($("#listCompanies ul li").removeClass("active"),$(this).removeClass("active"),$(".blockWrap").slideUp()):($("#listCompanies ul li").removeClass("active"),$(this).addClass("active"),$(".blockWrap").slideDown())}),l.sort(function(e,n){return e.value<n.value?1:e.value>n.value?-1:void 0});for(var s=0;s<l.length;s++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+l[s].value+"%</h2></div><div class='partnerBox'><h2>"+l[s].name+"</h2></div></div></li>");$("#sort .fa-caret-up").on("click",function(){l.sort(function(e,n){return e.name>n.name?1:e.name<n.name?-1:void 0}),$("#partnersList").empty();for(var e=0;e<l.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+l[e].value+"%</h2></div><div class='partnerBox'><h2>"+l[e].name+"</h2></div></div></li>")}),$("#sort .fa-caret-down").on("click",function(){l.sort(function(e,n){return e.name<n.name?1:e.name>n.name?-1:void 0}),$("#partnersList").empty();for(var e=0;e<l.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+l[e].value+"%</h2></div><div class='partnerBox'><h2>"+l[e].name+"</h2></div></div></li>")}),$("#percent .fa-caret-up").on("click",function(){l.sort(function(e,n){return e.value>n.value?1:e.value<n.value?-1:void 0}),$("#partnersList").empty();for(var e=0;e<l.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+l[e].value+"%</h2></div><div class='partnerBox'><h2>"+l[e].name+"</h2></div></div></li>")}),$("#percent .fa-caret-down").on("click",function(){l.sort(function(e,n){return e.value<n.value?1:e.value>n.value?-1:void 0}),$("#partnersList").empty();for(var e=0;e<l.length;e++)$("#partnersList").append("<li><div class='partnerContainer'><div class='percentBox'><h2>"+l[e].value+"%</h2></div><div class='partnerBox'><h2>"+l[e].name+"</h2></div></div></li>")}),Highcharts.chart("container",{chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie",context:!0},credits:{enabled:!1},exporting:{buttons:{contextButton:{enabled:!1}}},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{name:"Brands",colorByPoint:!0,data:i()}],responsive:{rules:[{condition:{minWidth:319}}]}}),$("#container").on("click",function(e){e.preventDefault();var n=e.target.attributes[6].value,t=a(r.list);$("#listLocations").empty();for(var i=0;i<t.length;i++)if(-1!==n.indexOf(i))for(var o=0;o<t[i].length;o++)$("#listLocations").append("<li>"+t[i][o]+"</li>");$("#overlay").fadeIn(400,function(){$("#modalForm").css("display","block").animate({opacity:1,top:"50%"},200)})}),$("#modalClose, #overlay").on("click",function(){$("#modalForm").animate({opacity:0,top:"45%"},200,function(){$(this).css("display","none"),$("#overlay").fadeOut(400)})})}).done(function(){$(".loader").delay(100).fadeOut("slow")}),$.getJSON("http://codeit.pro/frontTestTask/news/getList",function(e){function n(e){for(var n=document.getElementsByClassName("swiper-slide"),a=0;a<n.length;a++)n[a].children[0].setAttribute("src",e[a].img),n[a].children[1].children[0].setAttribute("href","http://"+e[a].link),e[a].description.length>200?(i=e[a].description.substring(0,199)+" ...",n[a].children[1].children[1].innerHTML=i):n[a].children[1].children[1].innerHTML=e[a].description,n[a].children[2].children[0].children[0].innerHTML=e[a].author,n[a].children[2].children[1].children[0].setAttribute("datetime",t(e[a].date)),n[a].children[2].children[1].children[0].innerHTML=t(e[a].date)}function t(e){var n=new Date(1e3*e),t=["01","02","03","04","05","06","07","08","09","10","11","12"];return n.getFullYear()+"-"+t[n.getMonth()]+"-"+(n.getDate()<10?"0"+n.getDate():n.getDate())}var a=e,i="";n(a.list)}).done(function(){$(".loader").delay(100).fadeOut("slow")})});